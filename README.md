# CoolResp или "хватит пытать себя расписанием".
CoolResp - программа для преобразования расписания от учебного отдела УрТИСИ СибГУТИ в читабельный вид.
Проект ещё не совершенен: изредка бывают проблемы в кабинетах, дизайн напоминает работу школьника, а сам код - чудовищная абберрация из грязнейших костылей и тёмной магии эльфийских регулярных выражений. Но несмотря на это, конвертер был отлажен на двадцати наборах тестовых данных, и уже сейчас показывает отличные результаты: всего за пару секунд он делает расписание читаемым и понятным, а возможность выбрать свои подгруппы - то о чём мечтает почти каждый первокурсник.
Из-за множества косяков в изначальных расписаниях, итог преобразования лучше проверять - модули парсинга и анализа отсеивают подавляющее большинство ошибок, но ведь всегда может появиться новое и необычное исключение. В таких случаях, нужно либо поменять исходный файл расписания, либо отправить тикет в [специальный раздел](https://github.com/DK905/CoolResp/issues). Правила баг-репорта можно найти [здесь]().

## Приступая к работе.
Есть два варианта начала работы с CoolResp:
1) Скачать и открыть исполняемый файл, который запустит готовый к работе конвертер;
2) Скачать проект, загрузить зависимости (Qt5, pyexcel, openpyxl, pyperclip), изменить всё под себя, запустить.

## Навигация по интерфейсу.


## В разработке.


## Как это устроено.
Чтобы конвертер не казался чёрным ящиком, магически обрабатывающим расписание, далее будет приведено описание идеи преобразования, на примере случая "когда обрабатывается нормальный файл расписания". Надеюсь, оно поможет тем, кто когда-нибудь решит улучшить сей проект.
### 1) Считывание
Общая схема считывания такова: считывание файла -> выбор нужного листа -> выбор нужной группы -> выделение ячеек расписания, относящихся к выбранной группе.
Для считывания, используется модуль pyexcel - он позволяет взаимодействовать как со старым форматом .xls, так и с новым .xlsx, считывая их в определённый объект (здесь это orderedDict).
После выбора листа, программа ищет строку с группами (в этой строке, первая ячейка всегда называется "дни"), попутно находя ячейку с периодом расписания, и определяя начало "расписательной" части листа (то есть той части, которая и содержит информацию о парах). 
Затем, составляется база разбора - примитивная аппликация ячеек с информацией о парах выбранной группы. Структура базы разбора подробно расписана в документации к модулю считывания.
### 2) Парсинг
Составленную базу разбора уже можно запарсить - вычленив из неё всю логическую информацию для каждого уникального вида пары. Уникальным видом здесь считается комбинация "день - номер пары - предмет - препод - тип пары - подгруппа". Из записей такого вида и формируется база парсинга.
Сам процесс парсинга состоит в последовательном вычленении необходимой информации из информационной ячейки. Такая ячейка, в нашем расписании, имеет множество синтаксических ошибок и разных шаблонов порядка записи разных элементов. Из-за этого, этап парсинга можно считать самым нестабильным: если где-то в исходном файле появляется новый тип синтаксического косяка, то он может испортить всё. Однако, существуют и закономерности: предмет всегда начинается только с большой буквы, у препода есть инициалы и т.п.
В процессе парсинга, синтаксические ошибки устраняются самыми разными проверками и ухищрениями, из-за чего код модуля имеет катастрофически низкую читаемость (чего стоит одна только регулярка на 300+ символов).
Из известных проблем парсинга, пока что можно выделить только хромую логику логического разброса кабинетов - в проекте реализована лишь её примерная версия, т.к для полноценной нужно выделить закономерности в ~шестиста наборах правильного распределения. Но и в текущем виде она работает почти идеально - за все тесты было обнаружено лишь десять ошибок распределения.
### 3) Анализ
Если этап парсинга успешно завершился, то базу парсинга можно спокойно анализировать.
Цель анализа заключается сразу в двух важных задачах:
- [ ] Определить количество подгрупп для каждого типа пары каждого предмета;
- [ ] Найти все случаи неправильной записи типа пары (когда одну из лаб по запаре назвали практикой и т.п).
### 4) Форматирование
Когда расписание запарсенно и проанализировано, с ним можно делать любые вещи - исследовать на соответствие учебному плану, ужаснуться количеству пар, или сохранить его в читаемой форме.
Для последнего, используется модуль openpyxl - хоть он и работает только с современным форматом .xlsx, его преимущество заключается в колоссальном количестве возможностей для форматирования сохранённых данных.
В процессе форматирования, конвертер объединяет и украшает всё что нужно объединить и украсить, после чего расписание может быть сохранено.

Для подробного описания лучше почитать документацию и комментарии к модулям, но первичное представление может быть получено и по этому скромному гайду.
